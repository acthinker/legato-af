<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Legato: Audio Service</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Simplifying M2M development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c_audio.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Audio Service </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="le__audio__interface_8h.html">Click here for the API reference documentation.</a></p>
<hr/>
<p>le_audio_interfaces<br/>
 le_audio_streams<br/>
 le_audio_connectors<br/>
 le_audio_formats<br/>
 le_audio_file_pb_rec<br/>
 le_audio_samples<br/>
</p>
<p>The Audio API handles audio interfaces including play or listen supported formats.</p>
<p>A Legato device can use several audio interfaces. You choose the input and output interfaces to tie together. The Audio stream related to a particular interface is represented with an 'Audio Stream Reference'.</p>
<p>You can create your own audio path by connecting several audio streams together using audio connectors.</p>
<p>An audio path can support more than two audio interfaces. You can have a basic output audio path of a voice call to connect the Modem Voice Received interface with the Speaker interface, and at the same time, the Modem Voice Received interface can be also connected to a Recorder Device interface.</p>
<h1><a class="anchor" id="le_audio_interfaces"></a>
Open/Close an Audio Interface</h1>
<p>The following functions let you select the desired interface:</p>
<ul>
<li><code><a class="el" href="le__audio__interface_8h.html#a74f1ef979329f6c2bd56ea622f4d05b2">le_audio_OpenMic()</a></code>: returns an Audio Stream Reference of the analog audio signal coming from the microphone input.</li>
<li><code><a class="el" href="le__audio__interface_8h.html#a5c19afce44021c4abf6193707317f8de">le_audio_OpenSpeaker()</a></code>: returns an Audio Stream Reference of the analog audio signal routed to the Speaker output.</li>
<li><code><a class="el" href="le__audio__interface_8h.html#acd8be89289067cef9441a8ed1d891146">le_audio_OpenUsbRx()</a></code>: returns an Audio Stream Reference of the digitized audio signal coming from an external device connected via USB Audio Class.</li>
<li><code><a class="el" href="le__audio__interface_8h.html#adb38f11ac78cf99160c19f69b4db0eb8">le_audio_OpenUsbTx()</a></code>: returns an Audio Stream Reference of the digitized audio signal routed to an external device connected via USB Audio Class.</li>
<li><code><a class="el" href="le__audio__interface_8h.html#aa0f0b5fcab8844c67a936d88fa050cf5">le_audio_OpenPcmRx()</a></code>: it returns an Audio Stream Reference of the digitized audio signal coming from an external device connected via the PCM interface.</li>
<li><code><a class="el" href="le__audio__interface_8h.html#a5e112543e8525775aa670dc71b320766">le_audio_OpenPcmTx()</a></code>: it returns an Audio Stream Reference of the digitized audio signal routed to an external device connected via the PCM interface.</li>
<li><code><a class="el" href="le__audio__interface_8h.html#a9e7d0042c4f422554eb10d64535608e5">le_audio_OpenI2sRx()</a></code>: it returns an Audio Stream Reference of the digitized audio signal coming from an external device connected via the I2S interface.</li>
<li><code><a class="el" href="le__audio__interface_8h.html#a2633c1368adf60e342d7cadbbfa6278b">le_audio_OpenI2sTx()</a></code>: it returns an Audio Stream Reference of the digitized audio signal routed to an external device connected via the I2S interface.</li>
<li><code><a class="el" href="le__audio__interface_8h.html#ae3ed568ba4d2763ea77e17e77b20ff02">le_audio_OpenModemVoiceRx()</a></code>: returns an Audio Stream Reference of the digitized audio signal coming from a voice call. The audio format is negotiated with the network when the call is established.</li>
<li><code><a class="el" href="le__audio__interface_8h.html#ad745f008bb04873c817da7af3daf783d">le_audio_OpenModemVoiceTx()</a></code>: returns an Audio Stream Reference of the digitized audio signal routed to a voice call. The audio format is negotiated with the network when the call is established.</li>
</ul>
<p>Multiple users can own the same stream at the same time.</p>
<p><code><a class="el" href="le__audio__interface_8h.html#a7e50add53e328c1dc6b680188990ebbb">le_audio_GetFormat()</a></code> can be called to get the audio format of an input or output stream.</p>
<p>Call <code><a class="el" href="le__audio__interface_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close()</a></code> to release it. If several users own the same, corresponding stream reference, the interface will close only after the last user releases the audio stream.</p>
<h1><a class="anchor" id="le_audio_streams"></a>
Control an Audio Stream</h1>
<p>Once the users get an Audio Stream reference, they can control it with the following functions:</p>
<ul>
<li><code><a class="el" href="le__audio__interface_8h.html#ad62587dacf0cb087697a62fb9f41d938">le_audio_SetGain()</a></code>: allows the user to adjust the gain of an audio stream (0 means 'muted', 100 is the maximum gain value).</li>
<li><code><a class="el" href="le__audio__interface_8h.html#a51a86829cdd6f27234f482e5dbb6c933">le_audio_GetGain()</a></code>: allows the User to retrieve the gain of an audio stream (0 means 'muted', 100 is the maximum gain value).</li>
<li><code><a class="el" href="le__audio__interface_8h.html#a147e97c49dbc003f63df78f97d5fca32">le_audio_Mute()</a></code>: allows the user to mute an audio stream.</li>
<li><code><a class="el" href="le__audio__interface_8h.html#adad24547293481964039efe56bc14e2b">le_audio_Unmute()</a></code>: allows the user to unmute an audio stream.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The hardware may or may not support the full 0-100 resolution, and if you want to see what was actually set call <a class="el" href="le__audio__interface_8h.html#a51a86829cdd6f27234f482e5dbb6c933">le_audio_GetGain()</a> after <a class="el" href="le__audio__interface_8h.html#ad62587dacf0cb087697a62fb9f41d938">le_audio_SetGain()</a> to get the real value.</dd></dl>
<h1><a class="anchor" id="le_audio_connectors"></a>
Create Audio connectors</h1>
<p>You can create your own audio path by connecting several audio streams together.</p>
<p><code><a class="el" href="le__audio__interface_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector()</a></code> function creates a reference to an audio connector.</p>
<p>You can tie an audio stream to a connector by calling the <a class="el" href="le__audio__interface_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect()</a> function.</p>
<p>You can remove an audio stream from a connector by calling the <a class="el" href="le__audio__interface_8h.html#a6b88df9301038375701e4c15a4c8aaf0">le_audio_Disconnect()</a> function.</p>
<p>When finished with it, delete it using the <code><a class="el" href="le__audio__interface_8h.html#a3f40b13ff980040503927f59bb3e86a9">le_audio_DeleteConnector()</a></code> function.</p>
<h1><a class="anchor" id="le_audio_formats"></a>
Specifying audio formats</h1>
<p>The encoding audio format can be specified to (or retrieved from) the audio interfaces that support this option. The format parameter is a string containing the IANA specified encoding format name for Real-Time protocol (RTP).</p>
<p>The complete list of the audio encoding format names can be found on the IANA organization web site (<a href="http://www.iana.org">http://www.iana.org</a>).</p>
<p>Function that gets the current audio format for an open interface is:</p>
<ul>
<li><code><a class="el" href="le__audio__interface_8h.html#a7e50add53e328c1dc6b680188990ebbb">le_audio_GetFormat()</a></code> </li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>Ensure to check the list of supported audio formats for your specific platform.</dd></dl>
<p>Some examples of audio formats:</p>
<ul>
<li>"L16-8K": Linear PCM 16-bit audio @ 8KHz</li>
<li>"L16-16K": Linear PCM 16-bit audio @ 16KHz</li>
<li>"GSM": European GSM Full Rate @ 8KHz (GSM 06.10)</li>
<li>"GSM-EFR": ITU-T GSM Enhanced Full Rate @ 8KHz (GSM 06.60)</li>
<li>"GSM-HR-08": ITU-T GSM Half Rate @ 8KHz (GSM 06.20)</li>
<li>"AMR": Adaptive Multi-Rate - Full Rate @ 8KHz</li>
<li>"AMR-HR": Adaptive Multi-Rate - Half Rate @ 8KHz</li>
<li>"AMR-WB": Adaptive Multi-Rate Wideband @ 16KHz</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The string is not case sensitive.</dd></dl>
<h1><a class="anchor" id="le_audio_file_pb_rec"></a>
Play and record audio</h1>
<p>An audio file can be played to any active output interfaces.</p>
<p>You must open a "File Playback" interface by calling:</p>
<ul>
<li><code><a class="el" href="le__audio__interface_8h.html#a34f3ed7c0885b2a1a29bdbfaf2099187">le_audio_OpenFilePlayback()</a></code>: returns an Audio Stream Reference for file playback. The audio file is played on the local audio interface like Speaker, USB Tx, PCM Tx, I2S Tx or on the remote audio interface Modem Voice Tx depending the kind of connector (input or output) is tied to.</li>
</ul>
<p>A "File Playback" interface can be opened only on an active output audio path. For instance, the "I2S Tx" and "Modem Voice Rx" must be previously connected before opening and connecting the "File Playback" interface on the same connector.</p>
<p>Audio file recording can be done from any active input interfaces.</p>
<p>You must open a "File Recording" interface by calling:</p>
<ul>
<li><code><a class="el" href="le__audio__interface_8h.html#a7d9b01ce8f55dcb47ae9e84a34c7cd12">le_audio_OpenFileRecording()</a></code>: returns an Audio Stream Reference for file recording. The local audio interface like Microphone, USB Rx, PCM Rx, I2S Rx is recorded into an audio file; or the Modem Voice Rx remote audio interface is recorded into an audio file, depending the kind of connector (input or output) is tied to.</li>
</ul>
<p>A "File Recording" interface can be opened only on an active input audio path. For instance, the "I2S Rx" and "Modem Voice Tx" must be previously connected before opening and connecting the "File Recording" interface on the same connector.</p>
<dl class="section note"><dt>Note</dt><dd>Only .wav file format is currently supported.</dd></dl>
<p>The function below is an example of how a file can be played to the Modem Voice Tx output interface. The audio of the voice call is redirected to the I2S interfaces. This function simply plays a voice prompt to the remote party when the voice call is established.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ConnectAudioAndPlayVoicePromptToRemoteParty</div>
<div class="line">(</div>
<div class="line">    <span class="keywordtype">void</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// I get the audio from the voice call.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> mdmRxAudioRef = <a class="code" href="le__audio_8h.html#ae3ed568ba4d2763ea77e17e77b20ff02">le_audio_OpenModemVoiceRx</a>();</div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> mdmTxAudioRef = <a class="code" href="le__audio_8h.html#ad745f008bb04873c817da7af3daf783d">le_audio_OpenModemVoiceTx</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I get the I2S interface references.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> i2sTxRef = <a class="code" href="le__audio_8h.html#a2633c1368adf60e342d7cadbbfa6278b">le_audio_OpenI2sTx</a>(0);</div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> i2sRxRef = <a class="code" href="le__audio_8h.html#a9e7d0042c4f422554eb10d64535608e5">le_audio_OpenI2sRx</a>(0);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I create the audio connectors.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a> audioInputConnectorRef = <a class="code" href="le__audio_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line">    <a class="code" href="le__audio_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a> audioOutputConnectorRef = <a class="code" href="le__audio_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// The voice call&#39;s audio is redirected to I2S interfaces.</span></div>
<div class="line">    <span class="keywordflow">if</span> (mdmRxAudioRef &amp;&amp; mdmTxAudioRef &amp;&amp; i2sTxRef &amp;&amp; i2sRxRef &amp;&amp;</div>
<div class="line">        audioInputConnectorRef &amp;&amp; audioOutputConnectorRef)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(audioInputConnectorRef, i2sRxRef);</div>
<div class="line">        <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(audioInputConnectorRef, mdmTxAudioRef);</div>
<div class="line">        <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(audioOutputConnectorRef, i2sTxRef);</div>
<div class="line">        <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(audioOutputConnectorRef, mdmRxAudioRef);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I get the interface reference for file playback.</span></div>
<div class="line">    <span class="keywordtype">int</span> fd = open(<span class="stringliteral">&quot;/myvoiceprompt.wav&quot;</span>, O_RDONLY));</div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> fileAudioRef = <a class="code" href="le__audio_8h.html#a34f3ed7c0885b2a1a29bdbfaf2099187">le_audio_OpenFilePlayback</a>(fd);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// The audio file is played on the input connector, the remote party can now here the voice</span></div>
<div class="line">    <span class="comment">// prompt.</span></div>
<div class="line">    <span class="keywordflow">if</span> (fileAudioRef &amp;&amp; audioInputConnectorRef)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(audioInputConnectorRef, fileAudioRef);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="le_audio_samples"></a>
Code samples</h1>
<p>The following two code samples show how to create different audio paths for an incoming voice call.</p>
<p>The first example has the audio path depending on an USB Audio handset. The <b>ConnectVoiceCallAudio()</b> function creates this audio path. A USB Audio handset plugged in and fully operationnal, will redirect the call audio to the handset; otherwise, it will redirect the call to the default microphone and speaker.</p>
<p>Use <code>DisconnectVoiceCallAudio()</code> to delete the audio path.</p>
<div class="fragment"><div class="line"><a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> ConnectVoiceCallAudio</div>
<div class="line">(</div>
<div class="line">    <a class="code" href="le__audio_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>*  audioInputConnectorRefPtr,  <span class="comment">// [OUT] Input connector.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>*  audioOutputConnectorRefPtr, <span class="comment">// [OUT] Output connector.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     mdmRxAudioRefPtr,           <span class="comment">// [OUT] Received voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     mdmTxAudioRefPtr,           <span class="comment">// [OUT] Transmitted voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     deviceRxAudioRefPtr,        <span class="comment">// [OUT] Received device audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     deviceTxAudioRefPtr         <span class="comment">// [OUT] Transmitted device audio stream.</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// I get the audio from the voice call.</span></div>
<div class="line">    *mdmRxAudioRefPtr = <a class="code" href="le__audio_8h.html#ae3ed568ba4d2763ea77e17e77b20ff02">le_audio_OpenModemVoiceRx</a>();</div>
<div class="line">    *mdmTxAudioRefPtr = <a class="code" href="le__audio_8h.html#ad745f008bb04873c817da7af3daf783d">le_audio_OpenModemVoiceTx</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If I cannot get the audio from the voice call, I return an error.</span></div>
<div class="line">    <span class="keywordflow">if</span> ((*mdmRxAudioRefPtr == NULL) || (*mdmTxAudioRefPtr == NULL))</div>
<div class="line">    {</div>
<div class="line">            <span class="comment">// I close the audio interfaces that have failed to open.</span></div>
<div class="line">            <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*mdmRxAudioRefPtr);</div>
<div class="line">            <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*mdmTxAudioRefPtr);</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca6bff37e5294d5f5be87549661e30844d">LE_NOT_POSSIBLE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I create the audio connectors.</span></div>
<div class="line">    *audioInputConnectorRefPtr = <a class="code" href="le__audio_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line">    *audioOutputConnectorRefPtr = <a class="code" href="le__audio_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I verify if my Audio USB handset is plugged and operational before trying to use it.</span></div>
<div class="line">    <span class="keywordflow">if</span>(IsMyUSBHandsetPlugged() == TRUE)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// I can redirect the audio to my USB handset using linear PCM audio format (PCM 16bits @ 16KHz)</span></div>
<div class="line">        *deviceRxAudioRefPtr = <a class="code" href="le__audio_8h.html#acd8be89289067cef9441a8ed1d891146">le_audio_OpenUsbRx</a>();</div>
<div class="line">        *deviceTxAudioRefPtr = <a class="code" href="le__audio_8h.html#adb38f11ac78cf99160c19f69b4db0eb8">le_audio_OpenUsbTx</a>();</div>
<div class="line"></div>
<div class="line">        <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioInputConnectorRefPtr, *deviceRxAudioRefPtr);</div>
<div class="line">        <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioOutputConnectorRefPtr, *deviceTxAudioRefPtr);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// There is no USB Audio handset, I redirect the audio to the in-built Microphone and Speaker.</span></div>
<div class="line">        *deviceRxAudioRefPtr = <a class="code" href="le__audio_8h.html#a74f1ef979329f6c2bd56ea622f4d05b2">le_audio_OpenMic</a>();</div>
<div class="line">        *deviceTxAudioRefPtr = <a class="code" href="le__audio_8h.html#a5c19afce44021c4abf6193707317f8de">le_audio_OpenSpeaker</a>();</div>
<div class="line"></div>
<div class="line">        <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioInputConnectorRefPtr, *deviceRxAudioRefPtr);</div>
<div class="line">        <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioOutputConnectorRefPtr, *deviceTxAudioRefPtr);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I tie the audio from the voice call to the connectors.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (*audioInputConnectorRefPtr, *mdmTxAudioRefPtr);</div>
<div class="line">    <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (*audioOutputConnectorRefPtr, *mdmRxAudioRefPtr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> DisconnectVoiceCallAudio</div>
<div class="line">(</div>
<div class="line">    <a class="code" href="le__audio_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>  audioInputConnectorRef,  <span class="comment">// [IN] Input connector.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>  audioOutputConnectorRef, <span class="comment">// [IN] Output connector.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     mdmRxAudioRef,           <span class="comment">// [IN] Received voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     mdmTxAudioRef,           <span class="comment">// [IN] Transmitted voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     deviceRxAudioRef,        <span class="comment">// [IN] Received device audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     deviceTxAudioRef         <span class="comment">// [IN] Transmitted device audio stream.</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// The call is terminated, I can close its audio interfaces.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(mdmRxAudioRef);</div>
<div class="line">    <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(mdmTxAudioRef);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I close all the device interfaces.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(deviceRxAudioRef);</div>
<div class="line">    <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(deviceTxAudioRef);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I delete the Audio connector references.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a3f40b13ff980040503927f59bb3e86a9">le_audio_DeleteConnector</a>(audioInputConnectorRef);</div>
<div class="line">    <a class="code" href="le__audio_8h.html#a3f40b13ff980040503927f59bb3e86a9">le_audio_DeleteConnector</a>(audioOutputConnectorRef);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The next code sample uses specific functions to deal with a new 'Incoming call' event during a call already in progress.</p>
<p>If no call is in progress, use the <code>ConnectVoiceCallAudio()</code> function to redirect the call audio to the in-built Microphone and Speaker.</p>
<p>If a new call is incoming, and considered a high priority call, you must mute the audio of the first call, and then connect the new call to your current audio path. Use <code>SwitchVoiceCallAudio()</code> for these actions.</p>
<p>When the high priority call terminates, you can return back to your previous call and reactivate its audio with the <code>SwitchBackVoiceCallAudio()</code> function.</p>
<div class="fragment"><div class="line"><a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> ConnectVoiceCallAudio</div>
<div class="line">(</div>
<div class="line">    <a class="code" href="le__audio_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>*  audioInputConnectorRefPtr,  <span class="comment">// [OUT] Input connector.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>*  audioOutputConnectorRefPtr, <span class="comment">// [OUT] Output connector.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     mdmRxAudioRefPtr,           <span class="comment">// [OUT] Received voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     mdmTxAudioRefPtr,           <span class="comment">// [OUT] Transmitted voice call audio stream.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     micRefPtr,                  <span class="comment">// [OUT] Microphone stream.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*     speakerRefPtr               <span class="comment">// [OUT] Speaker stream.</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    *mdmRxAudioRefPtr = <a class="code" href="le__audio_8h.html#ae3ed568ba4d2763ea77e17e77b20ff02">le_audio_OpenModemVoiceRx</a>();</div>
<div class="line">    *mdmTxAudioRefPtr = <a class="code" href="le__audio_8h.html#ad745f008bb04873c817da7af3daf783d">le_audio_OpenModemVoiceTx</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If I cannot get the audio from the voice call, I return an error.</span></div>
<div class="line">    <span class="keywordflow">if</span> ((*mdmRxAudioRefPtr == NULL) || (*mdmTxAudioRefPtr == NULL))</div>
<div class="line">    {</div>
<div class="line">            <span class="comment">// I close the audio interfaces that  have failed to open.</span></div>
<div class="line">            <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*mdmRxAudioRefPtr);</div>
<div class="line">            <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*mdmTxAudioRefPtr);</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca6bff37e5294d5f5be87549661e30844d">LE_NOT_POSSIBLE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    *audioInputConnectorRefPtr = <a class="code" href="le__audio_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line">    *audioOutputConnectorRefPtr = <a class="code" href="le__audio_8h.html#a570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Redirect audio to the in-built Microphone and Speaker.</span></div>
<div class="line">    *speakerRefPtr = <a class="code" href="le__audio_8h.html#a5c19afce44021c4abf6193707317f8de">le_audio_OpenSpeaker</a>();</div>
<div class="line">    *micRefPtr = <a class="code" href="le__audio_8h.html#a74f1ef979329f6c2bd56ea622f4d05b2">le_audio_OpenMic</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioInputConnectorRefPtr, *micRefPtr);</div>
<div class="line">    <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (*audioInputConnectorRefPtr, *mdmTxAudioRefPtr);</div>
<div class="line">    <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(*audioOutputConnectorRefPtr, *speakerRefPtr);</div>
<div class="line">    <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (*audioOutputConnectorRefPtr, *mdmRxAudioRefPtr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> SwitchVoiceCallAudio</div>
<div class="line">(</div>
<div class="line">    <a class="code" href="le__audio_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>  audioInputConnectorRef,  <span class="comment">// [IN] Input connector.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#ab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a>  audioOutputConnectorRef, <span class="comment">// [IN] Output connector.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     oldMdmRxAudioRef,        <span class="comment">// [IN] Received audio stream of the previous voice call.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>     oldMdmTxAudioRef,        <span class="comment">// [IN] Transmitted audio stream of the previous voice call.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*    newMdmRxAudioRefPtr,     <span class="comment">// [OUT] Received audio stream of the new voice call.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>*    newMdmTxAudioRefPtr      <span class="comment">// [OUT] Transmitted audio stream of the new voice call.</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> ((newMdmRxAudioRefPtr == NULL)     ||</div>
<div class="line">        (newMdmTxAudioRefPtr == NULL))</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cabe505065132f6e8850da6f476d8fb783">LE_BAD_PARAMETER</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    *newMdmRxAudioRefPtr = <a class="code" href="le__audio_8h.html#ae3ed568ba4d2763ea77e17e77b20ff02">le_audio_OpenModemVoiceRx</a>();</div>
<div class="line">    *newMdmTxAudioRefPtr = <a class="code" href="le__audio_8h.html#ad745f008bb04873c817da7af3daf783d">le_audio_OpenModemVoiceTx</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If I cannot get the audio from the voice call, I return an error.</span></div>
<div class="line">    <span class="keywordflow">if</span> ((*newMdmRxAudioRefPtr == NULL) || (*newMdmTxAudioRefPtr == NULL))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// I close the audio interfaces that have failed to open.</span></div>
<div class="line">        <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*newMdmRxAudioRefPtr);</div>
<div class="line">        <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(*newMdmTxAudioRefPtr);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca6bff37e5294d5f5be87549661e30844d">LE_NOT_POSSIBLE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I mute the previous call.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a147e97c49dbc003f63df78f97d5fca32">le_audio_Mute</a>(oldMdmRxAudioRef);</div>
<div class="line">    <a class="code" href="le__audio_8h.html#a147e97c49dbc003f63df78f97d5fca32">le_audio_Mute</a>(oldMdmTxAudioRef);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I connect the new incoming call.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (audioInputConnectorRef, *newMdmTxAudioRefPtr);</div>
<div class="line">    <a class="code" href="le__audio_8h.html#a338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a> (audioOutputConnectorRef, *newMdmRxAudioRefPtr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> SwitchBackVoiceCallAudio</div>
<div class="line">(</div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>  oldMdmRxAudioRef, <span class="comment">// [IN] Received audio stream of the previous voice call.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>  oldMdmTxAudioRef, <span class="comment">// [IN] Transmitted audio stream of the previous voice call.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>  newMdmRxAudioRef, <span class="comment">// [IN] Received audio stream of the new voice call.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#a9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a>  newMdmTxAudioRef  <span class="comment">// [IN] Transmitted audio stream  of the new voice call.</span></div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// I can delete the new call audio interfaces.</span></div>
<div class="line">    <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(newMdmRxAudioRef);</div>
<div class="line">    <a class="code" href="le__audio_8h.html#abafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(newMdmTxAudioRef);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// I can re-open the previous call streaming.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="le__audio_8h.html#adad24547293481964039efe56bc14e2b">le_audio_Unmute</a>(oldMdmRxAudioRef) != <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac409634423b6b1ef09643529f6224798">LE_FAULT</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="le__audio_8h.html#adad24547293481964039efe56bc14e2b">le_audio_Unmute</a>(oldMdmTxAudioRef) != <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac409634423b6b1ef09643529f6224798">LE_FAULT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><hr/>
<p>Copyright (C) Sierra Wireless, Inc. 2014. Use of this work is subject to license. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="http://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless 2014
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.6
        </div>
    </div>
</body>
</html>
