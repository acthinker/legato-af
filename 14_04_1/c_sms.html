<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Legato: SMS Services</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Simplifying M2M development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c_sms.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SMS Services </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="sms__interface_8h.html">Click here for the API reference documentation.</a></p>
<hr/>
<p>This file contains data structures and prototypes definitions for high level SMS APIs.</p>
<p><a class="el" href="c_sms.html#le_sms_ops_creating_msg">Creating a Message object</a> <br/>
 <a class="el" href="c_sms.html#le_sms_ops_deleting_msg">Deleting a Message object</a> <br/>
 <a class="el" href="c_sms.html#le_sms_ops_sending">Sending a message</a> <br/>
 <a class="el" href="c_sms.html#le_sms_ops_receiving">Receiving a message</a> <br/>
 <a class="el" href="c_sms.html#le_sms_ops_listing">Listing messages recorded in storage area</a> <br/>
 <a class="el" href="c_sms.html#le_sms_ops_deleting">Deleting a message from the storage area</a> <br/>
 <a class="el" href="c_sms.html#le_sms_ops_samples">Sample codes</a> <br/>
</p>
<p>SMS is a common way to communicate in the M2M world.</p>
<p>It's an easy, fast way to send a small amount of data (e.g., sensor values for gas telemetry). Usually, the radio module requests small power resources to send or receive a message. It's often a good way to wake-up a device that was disconnected from the network or that was operating in low power mode.</p>
<h1><a class="anchor" id="le_sms_ops_creating_msg"></a>
Creating a Message object</h1>
<p>There are 3 kinds of supported messages: text messages, binary messages, and PDU messages.</p>
<p>You must create a Message object by calling <code><a class="el" href="sms__interface_8h.html#a668abcbcff2f1f3c5cdf799315a81058">le_sms_Create()</a></code> before using the message APIs. It automatically allocates needed resources for the Message object, which is referenced by <code>le_sms_MsgRef_t</code> type.</p>
<p>When the Message object is no longer needed, call <code><a class="el" href="sms__interface_8h.html#aca1691010c88995cb47225f2889910fa">le_sms_Delete()</a></code> to free all allocated resources associated with the object.</p>
<h1><a class="anchor" id="le_sms_ops_deleting_msg"></a>
Deleting a Message object</h1>
<p>To delete a Message object, call <a class="el" href="sms__interface_8h.html#aca1691010c88995cb47225f2889910fa">le_sms_Delete()</a>. This frees all the resources allocated for the Message object. If several users own the Message object (e.g., several handler functions registered for SMS message reception), the Message object will be deleted only after the last user deletes the Message object.</p>
<h1><a class="anchor" id="le_sms_ops_sending"></a>
Sending a message</h1>
<p>To send a message, create an <code>le_sms_MsgRef_t</code> object by calling the <code><a class="el" href="sms__interface_8h.html#a668abcbcff2f1f3c5cdf799315a81058">le_sms_Create()</a></code> function. Then, set all the needed parameters for the message:</p>
<ul>
<li>Destination telephone number with <a class="el" href="sms__interface_8h.html#a145d3215f5601b88ef80b2674a9df226">le_sms_SetDestination()</a>;</li>
<li>Text content with <a class="el" href="sms__interface_8h.html#a34dc999430c46530d6c9067f800c5d72">le_sms_SetText()</a>, the total length are set as well with this API, maximum 160 characters as only the 7-bit alphabet is supported.</li>
<li>Binary content with <a class="el" href="sms__interface_8h.html#a2abf46b6d57c473bb06caf701a04183e">le_sms_SetBinary()</a>, total length is set with this API, maximum 140 bytes.</li>
<li>PDU content with <a class="el" href="sms__interface_8h.html#ab7295e1cdf2adb865135d657ec8bde09">le_sms_SetPDU()</a>, total length is set with this API, max 36 (header) + 140 (payload) bytes long.</li>
</ul>
<p>After the le_sms_MsgRef_t object is ready, call <code><a class="el" href="sms__interface_8h.html#ab7dee7d2c74cfcadd9ea0d5fe1786dfc">le_sms_Send()</a></code>.</p>
<p><code><a class="el" href="sms__interface_8h.html#ab7dee7d2c74cfcadd9ea0d5fe1786dfc">le_sms_Send()</a></code> is a blocking function, it will return once the Modem has given back a positive or negative answer to the sending operation. The return of <code><a class="el" href="sms__interface_8h.html#ab7dee7d2c74cfcadd9ea0d5fe1786dfc">le_sms_Send()</a></code> API provides definitive status of the sending operation.</p>
<p>Message object is never deleted regardless of the sending result. Caller has to delete it.</p>
<div class="fragment"><div class="line">[...]</div>
<div class="line"></div>
<div class="line"><a class="code" href="le__sms_8h.html#a8eb2a15362fe26516fc68fd7a7d5e3e7">le_sms_MsgRef_t</a> myTextMsg;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create a Message Object</span></div>
<div class="line">myTextMsg = <a class="code" href="le__sms_8h.html#a668abcbcff2f1f3c5cdf799315a81058">le_sms_Create</a>();</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set the telephone number</span></div>
<div class="line"><a class="code" href="le__sms_8h.html#a2d459c750a9b1817cf0bcebafbf6f0ef">le_sms_SetDestination</a>(myTextMsg, <span class="stringliteral">&quot;+33606060708&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set the message text</span></div>
<div class="line"><a class="code" href="le__sms_8h.html#a1284d11cda6092f4d498da0c0e2353fc">le_sms_SetText</a>(myTextMsg, <span class="stringliteral">&quot;Hello, this is a Legato SMS message&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Send the message</span></div>
<div class="line"><a class="code" href="le__sms_8h.html#ab7dee7d2c74cfcadd9ea0d5fe1786dfc">le_sms_Send</a>(myTextMsg);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Delete the message</span></div>
<div class="line"><a class="code" href="le__sms_8h.html#aca1691010c88995cb47225f2889910fa">le_sms_Delete</a>(myTextMsg);</div>
</div><!-- fragment --><h1><a class="anchor" id="le_sms_ops_receiving"></a>
Receiving a message</h1>
<p>To receive SMS messages, register a handler function to obtain incoming messages. Use <code><a class="el" href="sms__interface_8h.html#a844d595f3ae8d170b2fff80d854abb8d">le_sms_AddRxMessageHandler()</a></code> to register that handler.</p>
<p>The handler must satisfy the following prototype: <code>typedef</code> void (*le_sms_RxMessageHandlerFunc_t)(le_sms_MsgRef_t msg).</p>
<p>When a new incoming message is received, a Message object is automatically created and the handler is called. This Message object is Read-Only, any calls of a le_sms_SetXXX API will return a LE_NOT_PERMITTED error.</p>
<p>Use the following APIs to retrieve message information and data from the Message object:</p>
<ul>
<li><a class="el" href="sms__interface_8h.html#a5c2b8ce7043b4732c7b0ede7c5d7118c">le_sms_GetFormat()</a> - determine if it is a PDU, a binary or a text message.</li>
<li><a class="el" href="sms__interface_8h.html#a68bfd509a8a3fd4ae39bde7ac5c32d8d">le_sms_GetSenderTel()</a> - get the sender's Telephone number.</li>
<li><a class="el" href="sms__interface_8h.html#aca83e53998bd7105e14011af41ba6499">le_sms_GetTimeStamp()</a> - get the timestamp sets by the Service Center.</li>
<li><a class="el" href="sms__interface_8h.html#a6165464dd3502b3c76b79b32206ba10f">le_sms_GetUserdataLen()</a> - get the message content (text or binary) length.</li>
<li><a class="el" href="sms__interface_8h.html#abb89b302e564f3d55d604bb0c0dda022">le_sms_GetPDULen()</a> - get the PDU message .</li>
<li><a class="el" href="sms__interface_8h.html#ac598dec158aed1e9fa134daf22c704db">le_sms_GetText()</a> - get the message text.</li>
<li><a class="el" href="sms__interface_8h.html#a0de50069a9df99adac983385106d9c09">le_sms_GetBinary()</a> - get the message binary content.</li>
<li><a class="el" href="sms__interface_8h.html#ae4b284d427ab7ec637056a6208fdd89e">le_sms_GetPDU()</a> - get the message PDU data.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>If two (or more) registered handler functions exist, they are all called and get the same message object reference.</dd></dl>
<p>If a succession of messages is received, a new Message object is created for each, and the handler is called for each new message.</p>
<p>Uninstall the handler function by calling <code><a class="el" href="sms__interface_8h.html#a2f474706ba6d7a40083fe1f50f530101">le_sms_RemoveRxMessageHandler()</a></code>. </p>
<dl class="section note"><dt>Note</dt><dd><code><a class="el" href="sms__interface_8h.html#a2f474706ba6d7a40083fe1f50f530101">le_sms_RemoveRxMessageHandler()</a></code> API does not delete the Message Object. The caller has to delete it.</dd></dl>
<div class="fragment"><div class="line">[...]</div>
<div class="line"></div>
<div class="line"><span class="comment">// Handler function for message reception</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> myMsgHandler</div>
<div class="line">(</div>
<div class="line">     <a class="code" href="le__sms_8h.html#a8eb2a15362fe26516fc68fd7a7d5e3e7">le_sms_MsgRef_t</a> msgRef,</div>
<div class="line">     <span class="keywordtype">void</span>*            contextPtr*</div>
<div class="line">)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span>   tel[LE_SMS_TEL_NMBR_MAX_LEN];</div>
<div class="line">    <span class="keywordtype">char</span>   text[<a class="code" href="le__sms_8h.html#ac1b7b4dad3b9f7f1fe602494123a10b0">LE_SMS_TEXT_MAX_LEN</a>];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="le__sms_8h.html#a5c2b8ce7043b4732c7b0ede7c5d7118c">le_sms_GetFormat</a>(msgRef) == <a class="code" href="le__sms_8h.html#a337778c44e63660c44fa2116699296c0a1bb6a0d76a622b1185ee879e1595dff8">LE_SMS_FORMAT_TEXT</a>)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="le__sms_8h.html#af3cae92eb9e866f508767e8559ec79ba">le_sms_GetSenderTel</a>(msgRef, tel, <span class="keyword">sizeof</span>(tel));</div>
<div class="line">        <a class="code" href="le__sms_8h.html#a863bd9eb16fe5ad6027c1a2df35d485b">le_sms_GetText</a>(msgRef, text, <span class="keyword">sizeof</span>(text));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot; A new text message has been received !&quot;</span>);</div>
<div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot; From tel.%s, text: \&quot;%s\&quot;&quot;</span>, tel, text);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot; I support only text messages !&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">[...]</div>
<div class="line"><span class="comment">// In the main function:</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="le__sms_8h.html#a77d2607cc541bf0369e69bb2d105d4bf">le_sms_RxMessageHandlerRef_t</a> HdlrRef;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Add an handler function to handle message reception</span></div>
<div class="line">HdlrRef=<a class="code" href="le__sms_8h.html#a39a29e6ec1b819d8c0251b6347deaf02">le_sms_AddRxMessageHandler</a>(myMsgHandler);</div>
<div class="line"></div>
<div class="line">[...]</div>
<div class="line"></div>
<div class="line"><span class="comment">// Remove Handler entry</span></div>
<div class="line"><a class="code" href="le__sms_8h.html#a469a4d08b9ccb8b61ed7b8294e6ee3ef">le_sms_RemoveRxMessageHandler</a>(HdlrRef);</div>
<div class="line"></div>
<div class="line">[...]</div>
</div><!-- fragment --><h1><a class="anchor" id="le_sms_ops_listing"></a>
Listing  messages recorded in storage area</h1>
<dl class="section note"><dt>Note</dt><dd>The default SMS message storage area is the SIM card. Change the storage setting through the SMS configuration APIs (available in a future version of API specification).</dd></dl>
<p>Call <code><a class="el" href="sms__interface_8h.html#aee4328f9e417108fa16794cc135073d0">le_sms_CreateRxMsgList()</a></code> to create a List object that lists the received messages present in the storage area, which is referenced by le_sms_MsgListRef_t type.</p>
<p>If messages are not present, the <a class="el" href="sms__interface_8h.html#aee4328f9e417108fa16794cc135073d0">le_sms_CreateRxMsgList()</a> returns NULL.</p>
<p>Once the list is available, call <code><a class="el" href="sms__interface_8h.html#a934253dee33a6090656876cff853b2c6">le_sms_GetFirst()</a></code> to get the first message from the list, and then call <code><a class="el" href="sms__interface_8h.html#ac3b6a30a6d4e4f21749b536184b836ec">le_sms_GetNext()</a></code> API to get the next message.</p>
<p>Call <code><a class="el" href="sms__interface_8h.html#a4027c05c4ee7552ab0e081caa315c8a2">le_sms_DeleteList()</a></code> to free all allocated resources associated with the List object.</p>
<p>Call <code><a class="el" href="sms__interface_8h.html#ae1843c72eca77cd6da94cb686e5c2ae8">le_sms_GetStatus()</a></code> to read the status of a message (Received Read, Received Unread).</p>
<p>To finish, you can also modify the received status of a message with <code><a class="el" href="sms__interface_8h.html#a3dbd11952804520512fed270d183461d">le_sms_MarkRead()</a></code> and <code><a class="el" href="sms__interface_8h.html#a6ef04e331af6563b79e77bb51b28bc55">le_sms_MarkUnread()</a></code>.</p>
<h1><a class="anchor" id="le_sms_ops_deleting"></a>
Deleting a message from the storage area</h1>
<dl class="section note"><dt>Note</dt><dd>The default SMS message storage area is the SIM card. Change this setting through the SMS configuration APIs (available in a future version of API specification).</dd></dl>
<p><code><a class="el" href="sms__interface_8h.html#aff755186b683b94ba2788b48e28284a3">le_sms_DeleteFromStorage()</a></code> deletes the message from the storage area. Message is identified with <code>le_sms_MsgRef_t</code> object. The API returns an error if the message is not found in the storage area.</p>
<h1><a class="anchor" id="le_sms_ops_samples"></a>
Sample codes</h1>
<p>A sample code that implements a function for Mobile Originated SMS message can be found in <b>smsMO.c</b> file (please refer to <a class="el" href="c_sms_sample_m_o.html">Sample code for Mobile Originated SMS message</a> page).</p>
<p>A sample code that implements a function for Mobile Terminated SMS message can be found in <b>smsMT.c</b> file (please refer to <a class="el" href="c_sms_sample_m_t.html">Sample code for Mobile Terminated SMS message</a> page).</p>
<p>These two samples can be easily compiled and run into the <b>sms</b> app, to install and use this app:</p>
<pre class="fragment">$ make ar7
$ bin/instapp  build/ar7/bin/samples/sms.ar7 &lt;ipaddress&gt;
</pre><p> where ipaddress is the address of your target device.</p>
<p>Then on your target, just run: </p>
<pre class="fragment">$ app start sms
</pre><p>The sample replies to the sender by the message "Message from &lt;phone number&gt; received". Where "phone number" is the sender's phone number.</p>
<hr/>
<p>Copyright (C) Sierra Wireless, Inc. 2014. All rights reserved. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="http://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless 2014
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.6
        </div>
    </div>
</body>
</html>
