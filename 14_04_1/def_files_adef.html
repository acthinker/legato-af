<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Legato: Legato adef Files</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Simplifying M2M development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('def_files_adef.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Legato adef Files </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>These sections are available in the .adef files:</p>
<h1><a class="anchor" id="sandboxed"></a>
sandboxed</h1>
<p>Specifies if the app will be launched inside a sandbox.</p>
<p>Permitted content in this section is:</p>
<ul>
<li><b>true</b> - app will be run inside of a sandbox.</li>
<li><b>false</b> - app won't be run in a sandbox.</li>
</ul>
<p>The default is <b>true</b>.</p>
<p>If an app is not inside of a sandbox (unsandboxed), it can see the target device's real root file system. A sandboxed app can't see the target's real root file system; instead, a sandboxed app has its own, separate root file system (which it can't leave).</p>
<p>Each app has its own user ID and primary group ID. User name and primary group name is "appxxxx", where the "xxxx" is replaced with the name of the app.</p>
<p>Sandboxed apps aren't allowed to be members of other groups and are not allowed to have any capabilities (see "man 7 capabilities") set on their executables.</p>
<p>Unsandboxed apps are allowed to have executables with capabilities and be members of other groups (see the "groups:" section).</p>
<p>While a user and/or group will be automatically created if missing for the specified app, only users and groups of sandboxed apps will be automatically deleted when those apps are uninstalled.</p>
<div class="fragment"><div class="line">sandboxed: <span class="keyword">false</span></div>
</div><!-- fragment --><h1><a class="anchor" id="start"></a>
start</h1>
<p>Specifies if the app should start automatically at start-up: "auto" sets the app to start automatically by the Supervisor. "manual" sets the app to start through a manual prompt to the Supervisor. Default is <b>auto</b>.</p>
<div class="fragment"><div class="line">start: <span class="keyword">auto</span></div>
</div><!-- fragment --><h1><a class="anchor" id="numProcs"></a>
numProcs</h1>
<p>Specifies the maximum number of processes allowed to run at one time: an integer number of processes. Default is <b>10</b>.</p>
<div class="fragment"><div class="line">numProcs: 4</div>
</div><!-- fragment --><h1><a class="anchor" id="mqueueSize"></a>
mqueueSize</h1>
<p>Specifies the maximum number of bytes that can be allocated for POSIX MQueues. Default is <b>512</b>.</p>
<div class="fragment"><div class="line">mqueueSize: 22</div>
</div><!-- fragment --><h1><a class="anchor" id="rtSignalQueueSize"></a>
rtSignalQueueSize</h1>
<p>Specifies the maximum number of real-time signals that can be queued (waiting for delivery) to processes. This can be per thread in the app.</p>
<p>Default is <b>100</b>.</p>
<div class="fragment"><div class="line">rtSignalQueueSize: 10</div>
</div><!-- fragment --><h1><a class="anchor" id="memLimit"></a>
memLimit</h1>
<p>Specifies the maximum amount of memory (in kilobytes) that all processes in an app can share. Default is <b>40960</b>.</p>
<div class="fragment"><div class="line">memLimit: 4000</div>
</div><!-- fragment --><h1><a class="anchor" id="cpuShare"></a>
cpuShare</h1>
<p>Specifies the relative cpu share for an application.</p>
<p>Cpu share is used to calculate the cpu percentage for a process relative to all other processes in the system. New cgroups and processes default value of <b>1024</b> if not otherwise configured. The actual percentage of the cpu allocated to a process is calculated like this:</p>
<p>(share value of process) / (sum of shares from all processes contending for the cpu)</p>
<p>All processes within a cgroup share the available cpu percentage share for that cgroup like this:</p>
<p>cgroupA is configured with the default share value, 1024. cgroupB is configured with 512 as its share value. cgroupC is configured with 2048 as its share value.</p>
<p>cgroupA has one process running. cgroupB has two processes running. cgroupC has one process running.</p>
<p>This assumes all processes in cgroupA, cgroupB and cgroupC are running and not blocked waiting for an I/O or timer event, and another system process is also running.</p>
<p>Sum of all shares (including the one system process) is 1024 + 512 + 2048 + 1024 = 4608</p>
<p>The process in cgroupA will get 1024/4608 = 22% of the cpu. The two processes in cgroupB will share 512/4608 = 11% of the cpu, each process getting 5.5%. The process in cgroupC will get 2048/4608 = 44% of the cpu. The system process will get 1024/4608 = 22% of the cpu.</p>
<div class="fragment"><div class="line">cpuShare: 512</div>
</div><!-- fragment --><h1><a class="anchor" id="fileSystemSize"></a>
fileSystemSize</h1>
<p>Specifies the maximum amount of RAM that can be consumed by an app's temporary (volatile) file system at runtime. Default is <b>128K</b> </p>
<div class="fragment"><div class="line">fileSystemSize: 120K</div>
</div><!-- fragment --><h1><a class="anchor" id="filesAdef"></a>
files</h1>
<p>Lists additional files to be included in an app so they’re available at runtime (e.g., audio files, web pages, executable scripts or programs from external build system).</p>
<p>Three things need to be specified for each file:</p>
<p><b>Access permissions</b> - any combination of one or more of the following letters, enclosed in square brackets:</p>
<ul>
<li>r = readable</li>
<li>w = writeable but changes will be discarded on reset</li>
<li>p = writeable and changes to it will be persistent (i.e., survive power failure or reset)</li>
<li>x = executable</li>
</ul>
<p>If permissions values are not specified, then read-only ([r]) is the default. </p>
<dl class="section note"><dt>Note</dt><dd>Access permissions aren't implemented yet.</dd></dl>
<p><b>Build system path</b> - file system path on the build PC where the file is located at build time.</p>
<p><b>Target path</b> - file system path inside the app sandbox on the target where the file will appear at runtime. The path can be relative to the directory where the .adef file is located. Paths of files included in the apps will be automatically prefixed during builds with "/opt/legato/apps/xxxx", where "xxxx" is replaced by the app name.</p>
<p>File paths can be enclosed in quotation marks (either single ' or double "). This is required when the file path contains spaces.</p>
<pre class="fragment">files:

    [r]     audio/alert.wav     /usr/share/sounds/
    [rx]  third-party/foobar/bin/foobar   /bin/
    htdocs/index.html   /var/www/
    "stuff/file name with spaces"  /usr/share/stuff/
    'stuff/another file'   /usr/share/stuff/
</pre><p><b>File Permissions</b></p>
<p>File permissions and ownership in the original file on the dev host file system are copied into the application for both users and groups.</p>
<p>When the application is installed on a target: <br/>
</p>
<ul>
<li>the owner and group are set to <code>root</code> on all files in the app.</li>
<li>the executable permission is removed from all files outside of the application's bin directory.</li>
<li>executable permission is granted to all directories.</li>
<li>executable permission is granted to all files inside the application's bin directory.</li>
<li>write permission is removed from everything in the application.</li>
<li>the <code>setuid</code> bit is cleared on everything in the application.</li>
</ul>
<h1><a class="anchor" id="executablesAdef"></a>
executables</h1>
<p>Lists executables to be constructed and moved to the “bin” directory inside the app.</p>
<p>An executable’s content is specified inside parentheses after the name, and can be one of these:</p>
<ul>
<li>relative file system path to source code file (e.g., a .c, .java, or .lua file)</li>
<li>component</li>
<li>relative file system path to library file (e.g., .a or .so file).</li>
</ul>
<p>Only .c files, components, and libraries are currently supported.</p>
<div class="fragment"><div class="line">executables:</div>
<div class="line"></div>
<div class="line">    myexe1 ( file1.c libgoodstuff.so )</div>
<div class="line">    myexe2 ( foobar toto )</div>
</div><!-- fragment --><p>If a component from the “components:” section is included in an executable, then that component will be built and linked into the executable, and its COMPONENT_INIT function will be run at process start-up. Furthermore, that component’s runtime files (shared libraries, Lua source code, etc.) will be packaged inside the application for installation on the target.</p>
<p>If a source file is included in an executable, the build tools will search for it in the file system according to the source search path. When found, it will be compiled (if written in a compiled language) and linked into the executable. Note that all the source files specified for an executable will together be considered a component (called "default"), and one of those source files will be expected to implement a COMPONENT_INIT function, which will get called at start-up.</p>
<p>If a library is “included in” an executable in this way, that library is expected to be found in the “import” or “files” section of the application’s .adef file or in the “files” section of the Component.cdef file of a component that appears in the “components:” section of the .adef file. When the executable is linked, it will be linked with these “included” libraries in the order in which they are listed. Note that it's permitted to list the same library more than once, as is sometimes necessary in order to satisfy all unresolved symbols, due to the single-pass nature of the linker.)</p>
<p>The mechanism by which the executable is constructed will depend on the type of content and the target device. For example, C files will be compiled and linked using the appropriate compiler tool chain, depending on what target device the application is being built for. The same goes for components written in C. Java code will be compiled to Java bytecode. Lua code will be simply copied into the application.</p>
<dl class="section note"><dt>Note</dt><dd>In some cases, there may be incompatibilities between components or source code files that prevent them from being included in the same executable. For example, you may not be able to put Java sources and C sources into the same executable together. If you do violate one of these restrictions, the build tools will tell you about it.</dd></dl>
<h1><a class="anchor" id="importAdef"></a>
import</h1>
<p>The <b>import</b> section lists things imported to the app’s sandbox at runtime from outside of the sandbox. The contents appear similar to the files: section’s content, but meanings are different: Things listed in the “import” section are expected to be found on the target at runtime. They are not copied into the app at build time; they're made accessible to the app inside of its sandbox at runtime.</p>
<p>Currently, only virtual file system objects (files, directories, named sockets and pipes, device files, etc.) are explicitly imported. (Note: IPC interfaces are imported by components using the Component.cdef file’s “import” section.)</p>
<p>This section is ignored if the app is not sandboxed (if sandboxed set to false).</p>
<p>Items in the import section have essentially the same format as items in the files section, except the first path must be an absolute path (beginning with ‘/’).</p>
<p>The first path is the object to be imported. This is an absolute path in the target’s file system, outside of the sandbox (beginning with ‘/’).</p>
<p>The second path is the absolute file system path inside the app’s sandbox where the object will appear at runtime.</p>
<p>File paths can be enclosed in quotation marks (either single ' or double "). This is required when the file path contains spaces.</p>
<pre class="fragment">import:
    // I get character stream input from outside via a named pipe (read-only)
    /var/run/someNamedPipe  /var/run/

    // I need read and write access to UART2.
    [rw] /dev/ttyS1  /dev/

    // I need to be able to play back audio files installed in /usr/local/share/audio.
    "/usr/local/share/audio/error message.wav" /usr/share/audio/
    '/usr/local/share/audio/success message.wav' /usr/share/audio/
</pre><p>Permissions settings in import can't override permissions on the object in the target’s file system. If an object is read-only for the app’s user account in the root file system, it'll still be read-only accessible inside the app’s sandbox (even if imported “[rw]” in the app’s .adef file).</p>
<p>File permissions and ownership (group and user) on the original file in the target system remain in effect inside the sandbox.</p>
<h1><a class="anchor" id="groupsAdef"></a>
groups</h1>
<p>Add an unsandboxed app's user to groups on the target system. Not permitted for sandboxed apps.</p>
<div class="fragment"><div class="line">groups:</div>
<div class="line">    www-data</div>
<div class="line">    modem</div>
</div><!-- fragment --><h1><a class="anchor" id="refprocessesAdef"></a>
processes</h1>
<p>The processes section of the .adef also has sub-sections, see <a class="el" href="def_files_processes_adef.html">adef processes</a>.</p>
<hr/>
<p>Copyright (C) Sierra Wireless, Inc. 2014. All rights reserved. Use of this work is subject to license. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="http://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless 2014
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.6
        </div>
    </div>
</body>
</html>
